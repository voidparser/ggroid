(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2827:(e,t,o)=>{Promise.resolve().then(o.bind(o,8270))},8270:(e,t,o)=>{"use strict";o.d(t,{default:()=>u});var n=o(5155),r=o(2115),a=o(6766);let l=e=>{let{label:t,value:o,min:r,max:a,step:l,onChange:i}=e;return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:t}),(0,n.jsx)("div",{className:"text-amber-400 font-mono text-sm",children:o})]}),(0,n.jsx)("input",{type:"range",className:"droid-slider w-full",min:r,max:a,step:l,value:o,onChange:e=>i(parseFloat(e.target.value))})]})},i=e=>{let{value:t,onChange:o}=e;return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("label",{htmlFor:"effectSelect",className:"block text-sm font-medium text-gray-300 mb-2",children:"Sound Effect"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("select",{id:"effectSelect",value:t,onChange:e=>o(e.target.value),className:"droid-input appearance-none pr-10",children:[{id:"normal",name:"Normal",description:"Regular droid sounds"},{id:"blatt",name:"Blatt",description:'Short "blatt" sounds (fart-like)'},{id:"trill",name:"Trill",description:"Excited trills (rapid up/down)"},{id:"whistle",name:"Whistle",description:"High-pitched whistle"},{id:"scream",name:"Scream",description:"Alarmed scream"},{id:"happy",name:"Happy",description:"Happy chirp sequence"},{id:"sad",name:"Sad",description:"Sad descending tone"},{id:"question",name:"Question",description:"Questioning up-trill"},{id:"random",name:"Random",description:"Random mixture of effects"}].map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," - ",e.description]},e.id))}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-400",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]})};var c=o(9688);let s=e=>{let{children:t,variant:o="primary",className:r="",onClick:a}=e;return(0,n.jsx)("button",{onClick:a,className:(0,c.QP)("px-6 py-3 font-medium rounded-lg transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-amber-500 text-gray-900 hover:bg-amber-600 focus:ring-amber-400",outline:"bg-transparent text-blue-400 border border-blue-400 hover:bg-blue-900/20 focus:ring-blue-500"}[o],r),children:t})},d=(0,r.forwardRef)((e,t)=>{let{className:o=""}=e;return(0,n.jsx)("canvas",{ref:t,className:o,width:600,height:200})});d.displayName="VisualizerCanvas";let u=()=>{let[e,t]=(0,r.useState)("Hello, I am R2-D2. This is a secret message."),[o,c]=(0,r.useState)(""),[u,f]=(0,r.useState)(.5),[g,h]=(0,r.useState)(.4),[m,p]=(0,r.useState)(12),[w,y]=(0,r.useState)(.6),[v,x]=(0,r.useState)("normal"),[b,G]=(0,r.useState)(!0),W=(0,r.useRef)(null),A=(0,r.useRef)(null),M=(0,r.useRef)(null),R=(0,r.useRef)(null),P=(0,r.useRef)(!1),I=(0,r.useRef)(!1),[j,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{if("function"==typeof window.ggwave_factory)return console.log("GGWave factory function already available in window"),S(!0),Promise.resolve();let e=document.querySelector('script[src="/ggwave/ggwave.js"]');if(e){if(console.log("GGWave script already in DOM, checking if it loaded properly"),await new Promise(e=>setTimeout(e,500)),"function"==typeof window.ggwave_factory)return console.log("GGWave factory function now available"),S(!0),Promise.resolve();console.warn("Script in DOM but factory not available, removing and reloading"),e.remove()}return new Promise((e,t)=>{let o=document.createElement("script");o.src="/ggwave/ggwave.js",o.defer=!0;let n=setTimeout(()=>{console.warn("Script load timeout, may need manual intervention"),e()},5e3);o.onload=()=>{clearTimeout(n),"function"==typeof window.ggwave_factory?console.log("GGWave script loaded successfully with factory available"):console.warn("Script loaded but factory not available, will check again later"),S(!0),e()},o.onerror=t=>{clearTimeout(n),console.error("Error loading GGWave script:",t),e()},document.body.appendChild(o)})};return(async()=>{try{await e();let t=1e3,o=0;for(;"function"!=typeof window.ggwave_factory&&o<3;)console.log("Waiting ".concat(t,"ms for GGWave factory to initialize (attempt ").concat(o+1,"/").concat(3,")...")),await new Promise(e=>setTimeout(e,t)),t*=2,o++;"function"==typeof window.ggwave_factory?console.log("GGWave factory function detected and ready to use"):console.warn("GGWave factory not detected after waiting, will try during initialization"),await C()?console.log("Audio setup completed successfully"):console.warn("Audio setup completed with some issues, will retry on first use")}catch(e){console.error("Error setting up audio:",e)}})(),()=>{W.current&&W.current.close().catch(console.error)}},[]);let C=async()=>{try{if(console.log("Initializing audio context and GGWave..."),W.current||(W.current=new(window.AudioContext||window.webkitAudioContext),console.log("Audio context created with sample rate:",W.current.sampleRate)),!M.current&&W.current)try{M.current=W.current.createAnalyser(),M.current.fftSize=2048,M.current.connect(W.current.destination)}catch(e){console.warn("Could not create analyzer node:",e)}if(!A.current){if("function"!=typeof window.ggwave_factory){for(let e of(console.error("GGWave factory not found. Waiting for script to load properly..."),[1e3,2e3,3e3]))if(console.log("Waiting ".concat(e,"ms for GGWave factory to load...")),await new Promise(t=>setTimeout(t,e)),"function"==typeof window.ggwave_factory){console.log("GGWave factory found after waiting");break}if("function"!=typeof window.ggwave_factory&&(console.log("Attempting to reload GGWave script..."),await new Promise((e,t)=>{let o=document.createElement("script");o.src="/ggwave/ggwave.js",o.async=!0,o.onload=()=>{console.log("GGWave script reloaded"),S(!0),e()},o.onerror=e=>{t(Error("Failed to reload GGWave script"))},document.body.appendChild(o)}),"function"!=typeof window.ggwave_factory))throw Error("GGWave library not loaded correctly after multiple attempts")}console.log("Creating GGWave instance...");let e=await window.ggwave_factory();console.log("GGWave factory obtained:",e);let t=e.getDefaultParameters?e.getDefaultParameters():{sampleRateInp:W.current.sampleRate,sampleRateOut:W.current.sampleRate};t.sampleRateInp=W.current.sampleRate,t.sampleRateOut=W.current.sampleRate,A.current=e.init(t),console.log("GGWave instance initialized:",A.current)}let e=null!==W.current,t=null!==M.current,o=null!==A.current;if(console.log("Audio initialization status: Audio Context: ".concat(e,", Analyser: ").concat(t,", GGWave: ").concat(o)),e&&t&&o)return V(),console.log("Audio and GGWave successfully initialized"),!0;throw Error("Incomplete audio initialization: Audio: ".concat(e,", Analyser: ").concat(t,", GGWave: ").concat(o))}catch(e){return console.error("Failed to initialize audio:",e),W.current||console.warn("Audio context initialization failed"),M.current||console.warn("Analyser initialization failed"),A.current||console.warn("GGWave initialization failed"),!1}},V=()=>{if(!M.current||!R.current){console.log("Visualization not available: missing analyzer or canvas");return}let e=M.current,t=R.current,o=t.getContext("2d");if(!o){console.warn("Could not get canvas context for visualization");return}let n=e.frequencyBinCount,r=new Uint8Array(n),a=()=>{requestAnimationFrame(a),e.getByteFrequencyData(r),o.fillStyle="#1a202c",o.fillRect(0,0,t.width,t.height);let l=t.width/n*2.5,i=0;for(let e=0;e<n;e++){let a;let c=r[e]/255*t.height;switch(v){case"normal":default:a=e/n*240;break;case"blatt":a=30+e/n*60;break;case"trill":a=180+e/n*60;break;case"whistle":a=90+e/n*60;break;case"scream":a=0+e/n*60;break;case"happy":a=60+e/n*60;break;case"sad":a=240+e/n*60;break;case"question":a=270+e/n*60;break;case"random":a=(Date.now()/50+5*e)%360}let s=P.current?"50%":"30%",d=P.current?c:.6*c;if(o.fillStyle="hsl(".concat(a,", 100%, ").concat(s,")"),o.fillRect(i,t.height-d,l,d),(i+=l+1)>t.width)break}};a()},k=(e,t)=>{if(!W.current)return e;let o=new Float32Array(e.length);for(let n=0;n<e.length;n++){let r=n/W.current.sampleRate,a=.8+.2*(.5+.5*Math.sin(2*Math.PI*t.lfoRate*r));if("blatt"===t.effect)a*=.8+.5*t.exaggeration*(Math.sin(2*Math.PI*30*r)>0?1:-.5);else if("trill"===t.effect)a*=1+.5*t.exaggeration*Math.sin(2*Math.PI*20*r);else if("scream"===t.effect){let e;a*=1+(+(.8+.2*Math.sin(2*Math.PI*13*r))*(.9+.1*Math.sin(2*Math.PI*27*r))*(.95+.05*Math.sin(2*Math.PI*41*r))-1)*t.exaggeration}else if("whistle"===t.effect)a*=1+.3*t.exaggeration*Math.sin(2*Math.PI*8*r);else if("happy"===t.effect)a*=1+.3*t.exaggeration*Math.sin(2*Math.PI*6*r);else if("sad"===t.effect)a*=1+.4*t.exaggeration*Math.sin(2*Math.PI*3*r);else if("question"===t.effect&&W.current){let o=W.current.sampleRate||48e3;a*=1+.3*t.exaggeration*Math.sin(2*Math.PI*(4+4*(r/(e.length/o)))*r)}let l=e[n],i=t.dutyCycle;l=l>0?l>i?1:l/i:l<-i?-1:l/i,o[n]=l*a}let n=0;for(let e=0;e<o.length;e++){let t=Math.abs(o[e]);t>n&&(n=t)}n<=1e-4&&(n=1);for(let e=0;e<o.length;e++)o[e]=o[e]/n*t.volume;return o},N=(e,t,o)=>{if(!W.current)return new Float32Array(0);let n=W.current.sampleRate,r=Math.floor(t*n),a=new Float32Array(r),l=e?800:1200,i=e?400:300,c=e?10:5;for(let t=0;t<r;t++){let o=t/n,r=2*Math.PI*(l+i*Math.sin(2*Math.PI*c*o))*o;a[t]=Math.sin(r)>(e?-.2:.2)?1:-1}let s=Math.floor(.05*r);for(let e=0;e<s;e++)a[e]*=e/s,a[r-1-e]*=e/s;return a},_=(e,t)=>{if(!t.addPersonality||!W.current)return e;let o=W.current.sampleRate,n=N(!0,.5,t),r=N(!1,.3,t),a=Math.floor(.1*o),l=new Float32Array(n.length+a+e.length+a+r.length);for(let e=0;e<n.length;e++)l[e]=n[e]*t.volume;let i=n.length+a;for(let t=0;t<e.length;t++)l[i+t]=e[t];let c=i+e.length+a;for(let e=0;e<r.length;e++)l[c+e]=r[e]*t.volume;return l},F=async t=>{let o=async()=>{if("function"==typeof window.ggwave_factory)return j||S(!0),!0;console.log("GGWave factory not available, attempting to initialize...");try{document.querySelectorAll('script[src="/ggwave/ggwave.js"]').forEach(e=>e.remove());let e=document.createElement("script");return e.src="/ggwave/ggwave.js",e.defer=!0,await Promise.race([new Promise(t=>{e.onload=()=>{console.log("GGWave script loaded"),S(!0),t(!0)},e.onerror=()=>{console.error("Error loading GGWave script"),t(!1)},document.body.appendChild(e)}),new Promise(e=>setTimeout(()=>{console.warn("Script load timeout"),e(!1)},5e3))]),await new Promise(e=>setTimeout(e,1e3)),"function"==typeof window.ggwave_factory}catch(e){return console.error("Failed to load GGWave script:",e),!1}};if(!await o()){alert("Could not load the GGWave library. Please refresh the page and try again.");return}try{var n,r,a,l,i,s,d,f,h,p;let o;if(W.current||(console.log("Creating new AudioContext..."),W.current=new(window.AudioContext||window.webkitAudioContext)),"suspended"===W.current.state&&(console.log("Resuming suspended AudioContext..."),await W.current.resume()),!M.current&&W.current&&(console.log("Creating new AnalyserNode..."),M.current=W.current.createAnalyser(),M.current.fftSize=2048,M.current.connect(W.current.destination)),!A.current&&"function"==typeof window.ggwave_factory){console.log("Creating new GGWave instance...");try{let e;let t=null,o=0;for(;!t&&o<3;){o++,console.log("GGWave factory attempt ".concat(o,"/").concat(3,"..."));try{t=await window.ggwave_factory()}catch(e){console.warn("Factory attempt ".concat(o," failed:"),e),o<3&&await new Promise(e=>setTimeout(e,500))}}if(!t)throw Error("GGWave factory returned null after multiple attempts");console.log("GGWave factory obtained successfully. Factory structure:",Object.keys(t));try{"function"==typeof t.getDefaultParameters?(e=t.getDefaultParameters(),console.log("Parameters obtained:",e)):(console.warn("getDefaultParameters not found, using hardcoded defaults"),e={sampleRateInp:48e3,sampleRateOut:48e3})}catch(t){console.error("Error getting parameters:",t),console.warn("Using hardcoded default parameters"),e={sampleRateInp:48e3,sampleRateOut:48e3}}if(null===(i=W.current)||void 0===i?void 0:i.sampleRate){let t=W.current.sampleRate;console.log("Setting sample rates to ".concat(t,"Hz")),e.sampleRateInp=t,e.sampleRateOut=t}else console.log("Using default sample rates (48000Hz)"),e.sampleRateInp=48e3,e.sampleRateOut=48e3;console.log("Attempting to initialize GGWave with params:",e);try{if("function"==typeof t.init)A.current=t.init(e),console.log("GGWave instance created, methods:",Object.keys(A.current));else if(console.log("No init function found, checking if factory has encode method..."),"function"==typeof t.encode)console.log("Factory has encode method, using factory as instance"),A.current=t;else throw Error("Neither init method nor encode method found on factory")}catch(e){console.error("Error during initialization:",e),console.log("Storing factory as instance for further inspection"),A.current=t}if(A.current){if("function"!=typeof A.current.encode){console.warn("encode method not found on instance, inspecting instance structure:",A.current);let e=!1;for(let t of["encode","wasm.encode","instance.encode","ggwave.encode","factory.encode"])try{let o=t.split("."),n=A.current;for(let e of o)if(n&&"object"==typeof n)n=n[e];else{n=void 0;break}if("function"==typeof n){console.log("Found encode function at path: ".concat(t));let o=n;A.current.encode=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return console.log("Calling encode function at ".concat(t," with args:"),n),o.apply(this,n)},e=!0;break}}catch(e){console.warn("Error checking path ".concat(t,":"),e)}e||console.error("Could not find encode function in GGWave instance")}else console.log("encode method found on instance")}console.log("GGWave instance created successfully!")}catch(e){throw console.error("Failed to create GGWave instance:",e),Error("Failed to create GGWave instance. Please try again with a different browser.")}}let x={audioContext:!!W.current,audioContextState:(null===(n=W.current)||void 0===n?void 0:n.state)||"none",analyser:!!M.current,ggwaveInstance:!!A.current};if(console.log("Audio component status:",x),!x.audioContext)throw Error("Audio context not available. Please try a different browser.");x.ggwaveInstance||(console.warn("GGWave instance not properly initialized, creating placeholder"),A.current||(A.current={_placeholderInstance:!0},x.ggwaveInstance=!0,console.log("Created placeholder GGWave instance, will try to get real instance during encoding"))),x.analyser&&R.current?V():console.warn("Visualization not available due to missing analyser or canvas"),(null===(r=W.current)||void 0===r?void 0:r.state)==="suspended"&&await W.current.resume();let G=t||e,j={volume:u,dutyCycle:g,lfoRate:m,exaggeration:w,effect:v,addPersonality:b};if(null===(a=A.current)||void 0===a?void 0:a._placeholderInstance){console.log("Detected placeholder instance, creating real GGWave instance now");try{if("function"==typeof window.ggwave_factory){console.log("Creating fresh GGWave instance from factory");let e=null;for(let t=0;t<3;t++)try{if(e=await window.ggwave_factory()){console.log("Factory created successfully on attempt",t+1);break}}catch(e){console.warn("Factory creation attempt ".concat(t+1," failed:"),e),await new Promise(e=>setTimeout(e,500))}if(e){let t=null;if("function"==typeof e.init){let o={sampleRateInp:(null===(s=W.current)||void 0===s?void 0:s.sampleRate)||48e3,sampleRateOut:(null===(d=W.current)||void 0===d?void 0:d.sampleRate)||48e3};try{t=e.init(o),console.log("Successfully created instance from factory.init()")}catch(e){console.warn("Error creating instance with init:",e)}}t?A.current=t:(console.log("Using factory directly as instance"),A.current=e)}}}catch(e){console.error("Failed to create real GGWave instance:",e)}}console.log("Encoding message with GGWave:",G),console.log("GGWave instance type:",typeof A.current,"Methods:",Object.keys(A.current||{}));let S=null;if("function"==typeof(null===(l=A.current)||void 0===l?void 0:l.encode))S=A.current.encode,console.log("Found encode directly on instance");else for(let e of(console.warn("No encode function found directly on instance, searching..."),[A.current,null===(f=A.current)||void 0===f?void 0:f.instance,null===(h=A.current)||void 0===h?void 0:h.Module,null===(p=A.current)||void 0===p?void 0:p.wasm,void 0!==window.ggwave?window.ggwave:null,void 0!==window.ggwaveInstance?window.ggwaveInstance:null,"function"==typeof window.ggwave_factory?await window.ggwave_factory():null]))if(e){if("function"==typeof e.encode){S=e.encode.bind(e),console.log("Found encode method on object:",e);break}for(let t of Object.getOwnPropertyNames(e)){let o=e[t];if(o&&"object"==typeof o){if("function"==typeof o.encode){S=o.encode.bind(o),console.log("Found encode on property ".concat(t));break}for(let e of Object.getOwnPropertyNames(o)){let n=o[e];if(n&&"object"==typeof n&&"function"==typeof n.encode){S=n.encode.bind(n),console.log("Found encode on deep property ".concat(t,".").concat(e));break}}if(S)break}}if(S)break}if(!S&&"function"==typeof window.ggwave_factory)try{console.log("Last attempt - getting fresh factory for encode function");let e=await window.ggwave_factory();e&&"function"==typeof e.init&&(console.log("Creating synthetic encode function with factory.init()"),S=function(t,o,n){console.log("Using synthetic encode function");try{var r,a;let l={sampleRateInp:(null===(r=W.current)||void 0===r?void 0:r.sampleRate)||48e3,sampleRateOut:(null===(a=W.current)||void 0===a?void 0:a.sampleRate)||48e3},i=e.init(l);if(i&&"function"==typeof i.encode)return i.encode(t,o,n);throw Error("Synthetic encode function failed to create valid instance")}catch(e){throw console.error("Synthetic encode function error:",e),e}})}catch(e){console.error("Final factory attempt failed:",e)}if(S?(A.current=A.current||{},A.current.encode=S,console.log("Successfully set encode method on GGWave instance")):(console.error("Could not find a working encode function - using synthetic audio"),A.current=A.current||{},A.current.encode=function(e){for(var t,o=arguments.length,n=Array(o>1?o-1:0),r=1;r<o;r++)n[r-1]=arguments[r];console.log("Using synthetic beep generator instead of GGWave");let a=(null===(t=W.current)||void 0===t?void 0:t.sampleRate)||48e3,l=1+.1*e.length,i=Math.floor(a*l),c=new Int16Array(i);for(let e=0;e<i;e++){let t=e/a,o=800+400*Math.sin(2*Math.PI*.5*t),n=Math.sin(2*Math.PI*o*t);Math.sin(2*Math.PI*4*t)>.5&&(n*=.7),c[e]=Math.floor(32767*n*.8)}return c}),console.log("Using encode function:",A.current.encode),!A.current||A.current._placeholderInstance||"true"===window.localStorage.getItem("ggroid_use_synthetic"))console.log("Using synthetic audio directly due to previous WASM errors"),o=y(G,j);else try{try{let e=A.current.encode.toString();console.log("Encode function signature:",e.substring(0,200))}catch(e){console.log("Unable to inspect encode function:",e)}console.log("All methods on instance:",Object.getOwnPropertyNames(A.current));try{console.log("Trying with just text as string"),o=A.current.encode(G.toString())}catch(e){try{console.log("Trying with text and protocol as strings"),o=A.current.encode(G.toString(),"1".toString())}catch(t){try{console.log("Trying with text, protocol, volume as strings"),o=A.current.encode(G.toString(),"1".toString(),"10")}catch(n){try{console.log("Trying with 4 string params"),o=A.current.encode(G.toString(),"1".toString(),"10","0")}catch(r){if([e,t,n,r].some(e=>e&&e.toString&&e.toString().includes("Aborted()"))){console.error("WASM module aborted - using synthetic audio");try{window.localStorage.setItem("ggroid_use_synthetic","true")}catch(e){console.warn("Could not save synthetic audio preference:",e)}o=y(G,j)}else try{console.log("Trying with numeric params"),o=A.current.encode(G,1,10,!1)}catch(e){console.error("All encode attempts failed:",e),o=y(G,j)}}}}}}catch(e){console.error("Unexpected error during encoding:",e),o=y(G,j)}function y(e,t){var o;console.log("Generating synthetic R2-D2 audio");let n=(null===(o=W.current)||void 0===o?void 0:o.sampleRate)||48e3,r=1+.1*e.length,a=Math.floor(n*r),l=new Int16Array(a),i=t.lfoRate||12,c=t.exaggeration||.6,s=t.effect||"normal";for(let e=0;e<a;e++){let t=e/n,o=800;"whistle"===s?o=1200:"scream"===s?o=600:"blatt"===s?o=500:"trill"===s&&(o=900);let a=400*Math.sin(2*Math.PI*.5*t);"scream"===s?a*=(1+.5*Math.sin(2*Math.PI*13*t))*(1+.3*Math.sin(2*Math.PI*7.3*t)):"trill"===s?a=350*Math.sin(2*Math.PI*3*t):"happy"===s?(o+=200,a=300*Math.sin(2*Math.PI*1.5*t)):"sad"===s&&(o-=200,a=200*Math.sin(2*Math.PI*.8*t));let d=o+a*c,u=Math.sin(2*Math.PI*d*t),f=.8+.2*Math.sin(2*Math.PI*i*t);if("blatt"===s)f*=.7+.3*(Math.sin(2*Math.PI*20*t)>0?1:.5);else if("question"===s){let e=t/r;e>.7&&(u*=.8+.4*Math.sin(2*Math.PI*(8+16*(e-.7)/.3)*t))}u*=f;let g="trill"===s?8:"scream"===s?12:"happy"===s?6:4,h="whistle"===s?.2:.5;Math.sin(2*Math.PI*g*t)>1-h&&(u*=.7),l[e]=Math.floor(32767*u*.8)}return l}console.log("Encoding successful, waveform data type:",typeof o,o?"Length: ".concat(o.length):"null");let C=new Float32Array(o.length);for(let e=0;e<o.length;e++)C[e]=o[e]/32768;let N=k(C,j);j.addPersonality&&(N=_(N,j));let F=W.current.createBuffer(1,N.length,W.current.sampleRate);F.getChannelData(0).set(N);let z=W.current.createBufferSource();z.buffer=F,M.current?z.connect(M.current):z.connect(W.current.destination),P.current=!0,z.onended=e=>{P.current&&(P.current=!1),I.current&&(I.current=!1)},z.start(),E(),t||c(G),console.log("Message sent:",G)}catch(e){console.error("Failed to send message:",e),alert("Failed to send message. Please check console for details.")}},E=()=>{let e=document.getElementById("r2d2");if(!e){console.log("R2-D2 element not found for animation");return}if(!0===I.current){console.log("R2-D2 already animated, skipping");return}I.current=!0,e.classList.add("floating","glowing");let t=10*Math.random()-5;e.style.transform="rotate(".concat(t,"deg)");let o=e.querySelector(".main-eye");o&&o.classList.add("beeping"),setTimeout(()=>{P.current||(e.classList.remove("floating","glowing"),e.style.transform="",o&&o.classList.remove("beeping"),I.current=!1)},2e3)},z=async()=>{var t,o,n,r,a,l,i,c,s,d,f;let h;let p=async()=>{if("function"==typeof window.ggwave_factory)return j||S(!0),!0;console.log("GGWave factory not available for WAV export, attempting to initialize...");try{document.querySelectorAll('script[src="/ggwave/ggwave.js"]').forEach(e=>e.remove());let e=document.createElement("script");return e.src="/ggwave/ggwave.js",e.defer=!0,await Promise.race([new Promise(t=>{e.onload=()=>{console.log("GGWave script loaded for WAV export"),S(!0),t(!0)},e.onerror=()=>{console.error("Error loading GGWave script for WAV export"),t(!1)},document.body.appendChild(e)}),new Promise(e=>setTimeout(()=>{console.warn("Script load timeout for WAV export"),e(!1)},5e3))]),await new Promise(e=>setTimeout(e,1e3)),"function"==typeof window.ggwave_factory}catch(e){return console.error("Failed to load GGWave script for WAV export:",e),!1}};if(!await p()){alert("Could not load the GGWave library for WAV export. Please refresh the page and try again.");return}try{if(W.current||(console.log("Creating new AudioContext for WAV export..."),W.current=new(window.AudioContext||window.webkitAudioContext)),"suspended"===W.current.state&&(console.log("Resuming suspended AudioContext for WAV export..."),await W.current.resume()),!A.current&&"function"==typeof window.ggwave_factory){console.log("Creating new GGWave instance for WAV export...");try{let e;let t=null,o=0;for(;!t&&o<3;){o++,console.log("GGWave factory attempt for WAV ".concat(o,"/").concat(3,"..."));try{t=await window.ggwave_factory()}catch(e){console.warn("Factory attempt for WAV ".concat(o," failed:"),e),o<3&&await new Promise(e=>setTimeout(e,500))}}if(!t)throw Error("GGWave factory returned null after multiple attempts for WAV export");console.log("GGWave factory obtained successfully for WAV export, getting parameters...");try{"function"==typeof t.getDefaultParameters?(e=t.getDefaultParameters(),console.log("Parameters obtained for WAV export:",e)):(console.log("getDefaultParameters method not available, using defaults"),e={sampleRateInp:(null===(a=W.current)||void 0===a?void 0:a.sampleRate)||48e3,sampleRateOut:(null===(l=W.current)||void 0===l?void 0:l.sampleRate)||48e3})}catch(t){console.error("Error getting parameters for WAV export:",t),e={sampleRateInp:(null===(i=W.current)||void 0===i?void 0:i.sampleRate)||48e3,sampleRateOut:(null===(c=W.current)||void 0===c?void 0:c.sampleRate)||48e3},console.log("Using fallback parameters:",e)}let n=(null===(r=W.current)||void 0===r?void 0:r.sampleRate)||48e3;console.log("Setting sample rates to ".concat(n,"Hz for WAV export")),e.sampleRateInp=n,e.sampleRateOut=n;let s=0;for(;!A.current&&s<3;){s++,console.log("GGWave instance initialization attempt for WAV ".concat(s,"/").concat(3,"..."));try{A.current=t.init(e),console.log("WAV export init result:",A.current)}catch(e){console.warn("Instance initialization attempt for WAV ".concat(s," failed:"),e),s<3&&await new Promise(e=>setTimeout(e,500))}}if(!A.current){console.log("Attempting one last initialization with minimal params for WAV export...");try{A.current=t.init({sampleRateInp:48e3,sampleRateOut:48e3})}catch(e){console.error("Final initialization attempt for WAV export failed:",e)}if(!A.current)throw Error("GGWave instance initialization failed after multiple attempts for WAV export")}console.log("GGWave instance created successfully for WAV export!")}catch(e){throw console.error("Failed to create GGWave instance for WAV export:",e),Error("Failed to create GGWave instance for WAV export. Please try again with a different browser.")}}let e={audioContext:!!W.current,audioContextState:(null===(n=W.current)||void 0===n?void 0:n.state)||"none",ggwaveInstance:!!A.current};if(console.log("WAV export component status:",e),!e.audioContext||!e.ggwaveInstance)throw Error("Audio system not fully initialized for WAV export. Status: ".concat(JSON.stringify(e)))}catch(e){console.error("Failed to initialize audio system for WAV export:",e),alert("Failed to initialize audio system for WAV export. Please reload the page and try again.");return}let y={volume:u,dutyCycle:g,lfoRate:m,exaggeration:w,effect:v,addPersonality:b};if((null===(t=A.current)||void 0===t?void 0:t._placeholderInstance)||"function"!=typeof(null===(o=A.current)||void 0===o?void 0:o.encode)){if(console.warn("No valid encode function found for WAV export, attempting to create one"),"function"==typeof window.ggwave_factory)try{console.log("Creating fresh GGWave instance for WAV export");let e=await window.ggwave_factory();if(e){if("function"==typeof e.init){let t={sampleRateInp:W.current.sampleRate||48e3,sampleRateOut:W.current.sampleRate||48e3};try{let o=e.init(t);o&&(console.log("Successfully created instance for WAV export"),A.current=o)}catch(e){console.warn("Error creating instance for WAV export:",e)}}(!A.current||A.current._placeholderInstance)&&(console.log("Using factory directly as instance for WAV export"),A.current=e)}}catch(e){console.error("Failed to create GGWave instance for WAV export:",e)}let e=null;if("function"==typeof(null===(s=A.current)||void 0===s?void 0:s.encode))e=A.current.encode,console.log("Found encode directly on instance for WAV");else for(let t of(console.warn("Searching for encode function for WAV export..."),[A.current,null===(d=A.current)||void 0===d?void 0:d.instance,null===(f=A.current)||void 0===f?void 0:f.Module,void 0!==window.ggwave?window.ggwave:null,void 0!==window.ggwaveInstance?window.ggwaveInstance:null,"function"==typeof window.ggwave_factory?await window.ggwave_factory():null]))if(t){if("function"==typeof t.encode){e=t.encode.bind(t),console.log("Found encode on object for WAV export");break}for(let o of Object.getOwnPropertyNames(t)){let n=t[o];if(n&&"function"==typeof n.encode){e=n.encode.bind(n),console.log("Found encode on ".concat(o," for WAV export"));break}}if(e)break}e||(console.log("Creating synthetic encode function for WAV export"),e=function(e){for(var t,o=arguments.length,n=Array(o>1?o-1:0),r=1;r<o;r++)n[r-1]=arguments[r];console.log("Using synthetic WAV generator");let a=(null===(t=W.current)||void 0===t?void 0:t.sampleRate)||48e3,l=Math.floor(a*(1+.1*e.length)),i=new Int16Array(l);for(let e=0;e<l;e++){let t=e/a,o=Math.sin(2*Math.PI*(1e3+500*Math.sin(2*Math.PI*.3*t))*t);o*=.8+.2*Math.sin(2*Math.PI*8*t),i[e]=Math.floor(32767*o*.8)}return i}),A.current=A.current||{},A.current.encode=e,console.log("Successfully set encode function for WAV export")}let x=!A.current||A.current._placeholderInstance||"true"===window.localStorage.getItem("ggroid_use_synthetic"),G={volume:y.volume,lfoRate:y.lfoRate,exaggeration:y.exaggeration,effect:y.effect};if(x)console.log("Using synthetic audio directly for WAV export due to previous WASM errors"),h=M(e,G);else try{try{console.log("Trying WAV encode with just text as string"),h=A.current.encode(e.toString())}catch(t){try{console.log("Trying WAV encode with text and protocol as strings"),h=A.current.encode(e.toString(),"1")}catch(o){try{console.log("Trying WAV encode with text, protocol, volume as strings"),h=A.current.encode(e.toString(),"1","10")}catch(n){try{console.log("Trying WAV encode with 4 string params"),h=A.current.encode(e.toString(),"1","10","0")}catch(r){if([t,o,n,r].some(e=>e&&e.toString&&e.toString().includes("Aborted()"))){console.error("WASM module aborted - using synthetic audio for WAV");try{window.localStorage.setItem("ggroid_use_synthetic","true")}catch(e){console.warn("Could not save synthetic audio preference:",e)}h=M(e,G)}else try{console.log("Trying WAV encode with numeric params"),h=A.current.encode(e,1,10,!1)}catch(t){console.error("All WAV encode attempts failed:",t),h=M(e,G)}}}}}}catch(t){console.error("Unexpected error during WAV encoding:",t),h=M(e,G)}function M(e,t){var o;console.log("Generating synthetic R2-D2 audio for WAV export");let n=(null===(o=W.current)||void 0===o?void 0:o.sampleRate)||48e3,r=1+.1*e.length,a=Math.floor(n*r),l=new Int16Array(a),i=t.lfoRate||12,c=t.exaggeration||.6,s=t.effect||"normal";for(let e=0;e<a;e++){let t=e/n,o=1e3;"whistle"===s?o=1400:"scream"===s?o=800:"blatt"===s?o=700:"trill"===s&&(o=1100);let a=500*Math.sin(2*Math.PI*.3*t);"scream"===s?a*=1+.5*Math.sin(2*Math.PI*13*t):"trill"===s?a=450*Math.sin(2*Math.PI*3*t):"happy"===s?(o+=200,a=400*Math.sin(2*Math.PI*1.5*t)):"sad"===s&&(o-=200,a=300*Math.sin(2*Math.PI*.8*t));let d=Math.sin(2*Math.PI*(o+a*c)*t),u=.8+.2*Math.sin(2*Math.PI*i*t);if("blatt"===s)u*=.7+.3*(Math.sin(2*Math.PI*20*t)>0?1:.5);else if("question"===s){let e=t/r;e>.7&&(d*=.8+.4*Math.sin(2*Math.PI*(8+16*(e-.7)/.3)*t))}d*=u,Math.sin(2*Math.PI*("trill"===s?8:"scream"===s?10:"happy"===s?6:4)*t)>1-("whistle"===s?.2:.5)&&(d*=.7),l[e]=Math.floor(29490.3*d)}return l}let R=new Float32Array(h.length);for(let e=0;e<h.length;e++)R[e]=h[e]/32768;let P=k(R,y);y.addPersonality&&(P=_(P,y));let I=new Int16Array(P.length);for(let e=0;e<P.length;e++)I[e]=32767*Math.min(1,Math.max(-1,P[e]));let C=new Blob([T(I.length,1,W.current.sampleRate,16),I],{type:"audio/wav"}),V=URL.createObjectURL(C),N=document.createElement("a");N.href=V,N.download="r2d2_message.wav",N.style.display="none",document.body.appendChild(N),N.click(),setTimeout(()=>{document.body.removeChild(N),URL.revokeObjectURL(V)},100)},T=(e,t,o,n)=>{let r=new ArrayBuffer(44),a=new DataView(r);return O(a,0,"RIFF"),a.setUint32(4,32+2*e,!0),O(a,8,"WAVE"),O(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t,!0),a.setUint32(24,o,!0),a.setUint32(28,o*t*n/8,!0),a.setUint16(32,t*n/8,!0),a.setUint16(34,n,!0),O(a,36,"data"),a.setUint32(40,2*e,!0),r},O=(e,t,o)=>{for(let n=0;n<o.length;n++)e.setUint8(t+n,o.charCodeAt(n))};return(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,n.jsxs)("div",{className:"lg:col-span-2 bg-gray-800 rounded-xl p-6 shadow-lg",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-4",children:"Message Controls"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{htmlFor:"messageInput",className:"block text-sm font-medium text-gray-300 mb-2",children:"Message to Send"}),(0,n.jsx)("textarea",{id:"messageInput",value:e,onChange:e=>t(e.target.value),className:"droid-input min-h-[120px]",placeholder:"Enter your message here..."})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,n.jsx)(l,{label:"Volume",value:u,min:0,max:1,step:.1,onChange:f}),(0,n.jsx)(l,{label:"Duty Cycle",value:g,min:.3,max:.7,step:.05,onChange:h}),(0,n.jsx)(l,{label:"Warble Rate (Hz)",value:m,min:5,max:20,step:1,onChange:p}),(0,n.jsx)(l,{label:"Exaggeration",value:w,min:0,max:1,step:.1,onChange:y})]}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 mb-6",children:[(0,n.jsx)("div",{className:"flex-grow",children:(0,n.jsx)(i,{value:v,onChange:x})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"personalityToggle",checked:b,onChange:e=>G(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,n.jsx)("label",{htmlFor:"personalityToggle",className:"text-white",children:"Add Droid Personality"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,n.jsx)(s,{onClick:()=>F("Test... test... test..."),variant:"secondary",children:"Test Sound"}),(0,n.jsx)(s,{onClick:()=>F(),variant:"primary",children:"Send Message"}),(0,n.jsx)(s,{onClick:z,variant:"outline",children:"Save as WAV"})]})]}),(0,n.jsxs)("div",{className:"lg:col-span-1 flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 shadow-lg",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-4",children:"Visualization"}),(0,n.jsx)("div",{className:"h-[200px] bg-gray-900 rounded-lg relative overflow-hidden",children:(0,n.jsx)(d,{ref:R,className:"w-full h-full"})}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)("div",{className:"w-32 h-32 relative",children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(a.default,{src:"/r2d2.svg",alt:"R2-D2",width:120,height:120,id:"r2d2",className:"transition-all duration-300"})})})})]}),(0,n.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 shadow-lg",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-4",children:"Received Message"}),(0,n.jsx)("div",{className:"bg-gray-900 rounded-lg p-4 min-h-[100px] text-white",children:o||"No messages received yet."})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[479,441,684,358],()=>t(2827)),_N_E=e.O()}]);